<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard PM - Controle de Efetivo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card h2 {
            color: #1e3c72;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: scale(1.05);
        }

        .btn-secondary {
            background: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background: #0b7dda;
            transform: scale(1.05);
        }

        .file-input {
            display: none;
        }

        .file-label {
            background: #FF9800;
            color: white;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .file-label:hover {
            background: #e68900;
            transform: scale(1.05);
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th, .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #1e3c72;
        }

        .data-table tr:hover {
            background-color: #f5f5f5;
        }

        .debug-info {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            display: none;
            border-left: 4px solid #f44336;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #1e3c72;
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 30px;
            padding: 20px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
            }
            
            .btn, .file-label {
                width: 100%;
                justify-content: center;
            }
            
            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Dashboard PM - Controle de Efetivo</h1>
            <p class="subtitle">Sistema de monitoramento e an치lise de dados operacionais</p>
        </header>

        <div class="controls">
            <button class="btn btn-primary" onclick="loadSampleData()">
                <i>游늵</i> Carregar Dados de Exemplo
            </button>
            <input type="file" id="fileInput" class="file-input" accept=".xlsx, .xls">
            <label for="fileInput" class="file-label">
                <i>游늬</i> Carregar Arquivo Excel
            </label>
            <button class="btn btn-secondary" onclick="exportData()">
                <i>游</i> Exportar Dados
            </button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Total de Viaturas</div>
                <div class="stat-value" id="totalVehicles">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Efetivo Ativo</div>
                <div class="stat-value" id="totalPersonnel">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">OPMs com Atua칞칚o</div>
                <div class="stat-value" id="totalOPMs">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Locais de Atua칞칚o</div>
                <div class="stat-value" id="totalLocations">0</div>
            </div>
        </div>

        <div class="dashboard">
            <div class="card">
                <h2>Distribui칞칚o por OPM</h2>
                <div class="chart-container">
                    <canvas id="opmChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h2>Distribui칞칚o por Gradua칞칚o</h2>
                <div class="chart-container">
                    <canvas id="graduationChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h2>Locais de Atua칞칚o</h2>
                <div class="chart-container">
                    <canvas id="locationChart"></canvas>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>Dados Detalhados</h2>
            <div class="table-container">
                <table class="data-table" id="dataTable">
                    <thead>
                        <tr>
                            <th>OPM</th>
                            <th>Viatura</th>
                            <th>Gradua칞칚o</th>
                            <th>Nome</th>
                            <th>Local</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Dados ser칚o inseridos aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <div class="debug-info" id="debugInfo">
            <!-- Mensagens de debug ser칚o exibidas aqui -->
        </div>

        <footer>
            <p>Sistema de Dashboard PM &copy; 2023 - Desenvolvido para controle operacional</p>
        </footer>
    </div>

    <script>
        // Vari치veis globais
        let currentData = [];
        let currentCharts = {};

        // Inicializa칞칚o quando a p치gina carrega
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar o listener para o input de arquivo
            document.getElementById('fileInput').addEventListener('change', processFiles);
            
            // Carregar dados de exemplo automaticamente
            loadSampleData();
        });

        // Fun칞칚o para exibir informa칞칫es de debug
        function showDebugInfo(message, type = 'info') {
            const debugDiv = document.getElementById('debugInfo');
            debugDiv.textContent = message;
            debugDiv.style.display = 'block';
            
            // Cor baseada no tipo de mensagem
            if (type === 'error') {
                debugDiv.style.background = '#ffebee';
                debugDiv.style.color = '#c62828';
                debugDiv.style.borderLeft = '4px solid #f44336';
            } else if (type === 'success') {
                debugDiv.style.background = '#e8f5e9';
                debugDiv.style.color = '#2e7d32';
                debugDiv.style.borderLeft = '4px solid #4caf50';
            } else {
                debugDiv.style.background = '#e3f2fd';
                debugDiv.style.color = '#1565c0';
                debugDiv.style.borderLeft = '4px solid #2196f3';
            }
            
            // Auto-esconder ap칩s 5 segundos para mensagens de info
            if (type === 'info') {
                setTimeout(() => {
                    debugDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Fun칞칚o para carregar dados de exemplo
        function loadSampleData() {
            showDebugInfo("Carregando dados de exemplo...", "info");
            
            // Dados de exemplo
            const sampleData = [
                { opm: "BTL LESTE", viatura: "VTR 1089", graduacao: "Cb PM", nome: "F. BATISTA", local: "치rea comercial" },
                { opm: "BTL LESTE", viatura: "VTR 1090", graduacao: "Cb PM", nome: "RIBAMAR", local: "치rea comercial" },
                { opm: "BTL LESTE", viatura: "VTR 1091", graduacao: "Cad I PM", nome: "C. FARIAS", local: "치rea comercial" },
                { opm: "BTL OESTE", viatura: "VTR 2015", graduacao: "Sgt PM", nome: "A. SILVA", local: "patrulha rural" },
                { opm: "BTL OESTE", viatura: "VTR 2016", graduacao: "Cb PM", nome: "M. SANTOS", local: "patrulha rural" },
                { opm: "BTL NORTE", viatura: "VTR 3050", graduacao: "3췈 Sgt PM", nome: "R. OLIVEIRA", local: "치rea residencial" },
                { opm: "BTL NORTE", viatura: "VTR 3051", graduacao: "Cb PM", nome: "J. COSTA", local: "치rea residencial" },
                { opm: "BTL SUL", viatura: "VTR 4020", graduacao: "2췈 Sgt PM", nome: "L. FERREIRA", local: "centro urbano" },
                { opm: "BTL SUL", viatura: "VTR 4021", graduacao: "Cb PM", nome: "P. RODRIGUES", local: "centro urbano" }
            ];
            
            // Processar os dados
            processExcelData(sampleData);
            showDebugInfo("Dashboard carregado com dados de exemplo. Use dois dedos para dar zoom nos gr치ficos.", "success");
        }

        // Fun칞칚o para processar arquivos Excel
        function processFiles() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) {
                showDebugInfo("Selecione um arquivo Excel!", "error");
                return;
            }
            
            showDebugInfo("Processando arquivo...", "info");
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Obter a primeira planilha
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    // Processar os dados
                    processExcelData(jsonData);
                    showDebugInfo("Arquivo processado com sucesso!", "success");
                } catch (error) {
                    showDebugInfo("Erro ao processar arquivo: " + error.message, "error");
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Fun칞칚o para processar dados do Excel
        function processExcelData(data) {
            currentData = data;
            
            // Atualizar a tabela
            updateDataTable();
            
            // Atualizar estat칤sticas
            updateStats();
            
            // Atualizar gr치ficos
            updateCharts();
        }

        // Fun칞칚o para atualizar a tabela de dados
        function updateDataTable() {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            currentData.forEach(item => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${item.opm || 'N/A'}</td>
                    <td>${item.viatura || 'N/A'}</td>
                    <td>${item.graduacao || 'N/A'}</td>
                    <td>${item.nome || 'N/A'}</td>
                    <td>${item.local || 'N/A'}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // Fun칞칚o para atualizar as estat칤sticas
        function updateStats() {
            // Total de viaturas 칰nicas
            const vehicles = [...new Set(currentData.map(item => item.viatura))];
            document.getElementById('totalVehicles').textContent = vehicles.length;
            
            // Total de efetivo
            document.getElementById('totalPersonnel').textContent = currentData.length;
            
            // OPMs 칰nicas
            const opms = [...new Set(currentData.map(item => item.opm))];
            document.getElementById('totalOPMs').textContent = opms.length;
            
            // Locais 칰nicos
            const locations = [...new Set(currentData.map(item => item.local))];
            document.getElementById('totalLocations').textContent = locations.length;
        }

        // Fun칞칚o para atualizar os gr치ficos
        function updateCharts() {
            // Destruir gr치ficos existentes
            Object.values(currentCharts).forEach(chart => {
                if (chart) chart.destroy();
            });
            
            // Dados para os gr치ficos
            const opmCounts = countBy(currentData, 'opm');
            const graduationCounts = countBy(currentData, 'graduacao');
            const locationCounts = countBy(currentData, 'local');
            
            // Cores para os gr치ficos
            const colors = [
                '#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b',
                '#858796', '#5a5c69', '#6f42c1', '#e83e8c', '#fd7e14'
            ];
            
            // Gr치fico de OPMs
            const opmCtx = document.getElementById('opmChart').getContext('2d');
            currentCharts.opm = new Chart(opmCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(opmCounts),
                    datasets: [{
                        label: 'Efetivo por OPM',
                        data: Object.values(opmCounts),
                        backgroundColor: colors.slice(0, Object.keys(opmCounts).length),
                        borderColor: colors.slice(0, Object.keys(opmCounts).length).map(color => color.replace('0.7', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });
            
            // Gr치fico de Gradua칞칫es
            const graduationCtx = document.getElementById('graduationChart').getContext('2d');
            currentCharts.graduation = new Chart(graduationCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(graduationCounts),
                    datasets: [{
                        data: Object.values(graduationCounts),
                        backgroundColor: colors.slice(0, Object.keys(graduationCounts).length),
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            // Gr치fico de Locais
            const locationCtx = document.getElementById('locationChart').getContext('2d');
            currentCharts.location = new Chart(locationCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(locationCounts),
                    datasets: [{
                        data: Object.values(locationCounts),
                        backgroundColor: colors.slice(0, Object.keys(locationCounts).length),
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        // Fun칞칚o auxiliar para contar ocorr칡ncias por propriedade
        function countBy(array, property) {
            return array.reduce((counts, item) => {
                const key = item[property] || 'N/A';
                counts[key] = (counts[key] || 0) + 1;
                return counts;
            }, {});
        }

        // Fun칞칚o para exportar dados
        function exportData() {
            if (currentData.length === 0) {
                showDebugInfo("N칚o h치 dados para exportar!", "error");
                return;
            }
            
            // Criar uma nova planilha
            const ws = XLSX.utils.json_to_sheet(currentData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Dados PM");
            
            // Exportar para Excel
            XLSX.writeFile(wb, "dados_pm_exportados.xlsx");
            showDebugInfo("Dados exportados com sucesso!", "success");
        }
    </script>
</body>
</html>
